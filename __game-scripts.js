var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.prototype.initialize=function(){var e=this.app.root.findByName("Camera");this.cameraScript=e.script.cameraMovement},PlayerMovement.worldDirection=new pc.Vec3,PlayerMovement.tempDirection=new pc.Vec3,PlayerMovement.prototype.update=function(e){var t=this.app,i=PlayerMovement.worldDirection;i.set(0,0,0);var r=PlayerMovement.tempDirection,a=this.entity.forward,o=this.entity.right,n=0,c=0;if(t.keyboard.isPressed(pc.KEY_A)&&(n-=1),t.keyboard.isPressed(pc.KEY_D)&&(n+=1),t.keyboard.isPressed(pc.KEY_W)&&(c+=1),t.keyboard.isPressed(pc.KEY_S)&&(c-=1),0!==n||0!==c){i.add(r.copy(a).mulScalar(c)),i.add(r.copy(o).mulScalar(n)),i.normalize();var s=new pc.Vec3(i.x*e,0,i.z*e);s.normalize().scale(this.speed),s.add(this.entity.getPosition());var p=this.cameraScript.eulers.x+180,d=new pc.Vec3(0,p,0);this.entity.rigidbody.teleport(s,d)}this.entity.anim.setFloat("xDirection",n),this.entity.anim.setFloat("zDirection",c)};var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var e=this.app;e.mouse.on("mousemove",this.onMouseMove,this),e.mouse.on("mousedown",this.onMouseDown,this),this.rayEnd=e.root.findByName("RaycastEndPoint"),this.on("destroy",(function(){e.mouse.off("mousemove",this.onMouseMove,this),e.mouse.off("mousedown",this.onMouseDown,this)}),this)},CameraMovement.prototype.postUpdate=function(e){var t=this.entity.parent,o=this.eulers.x+180,s=this.eulers.y,i=new pc.Vec3(-s,o,0);t.setEulerAngles(i),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(t.getPosition())},CameraMovement.prototype.onMouseMove=function(e){pc.Mouse.isPointerLocked()&&(this.eulers.x-=this.mouseSpeed*e.dx/60%360,this.eulers.y+=this.mouseSpeed*e.dy/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360))},CameraMovement.prototype.onMouseDown=function(e){this.app.mouse.enablePointerLock()},CameraMovement.prototype.getWorldPoint=function(){var e=this.entity.parent.getPosition(),t=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(e,t);return o?o.point:t};var SAMPLE_COUNT=15;function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,o,r,s){e[0]=computeGaussian(0,s),t[0]=0,t[1]=0;var i,a,l=e[0];for(i=0,a=Math.floor(SAMPLE_COUNT/2);i<a;i++){var u=computeGaussian(i+1,s);e[2*i]=u,e[2*i+1]=u,l+=2*u;var h=2*i+1.5;t[4*i]=o*h,t[4*i+1]=r*h,t[4*i+2]=-o*h,t[4*i+3]=-r*h}for(i=0,a=e.length;i<a;i++)e[i]/=l}function BloomEffect(e){pc.PostEffect.call(this,e);var t={aPosition:pc.SEMANTIC_POSITION},o=["varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["#define SAMPLE_COUNT "+SAMPLE_COUNT,"","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets["+SAMPLE_COUNT+"];","uniform float uBlurWeights["+SAMPLE_COUNT+"];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),s=["varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,o,"BloomExtractShader",t),this.blurShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,r,"BloomBlurShader",t),this.combineShader=pc.createShaderFromCode(e,pc.PostEffect.quadVertexShader,s,"BloomCombineShader",t),this.targets=[],this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(SAMPLE_COUNT),this.sampleOffsets=new Float32Array(2*SAMPLE_COUNT)}BloomEffect.prototype=Object.create(pc.PostEffect.prototype),BloomEffect.prototype.constructor=BloomEffect,BloomEffect.prototype._destroy=function(){var e;if(this.targets)for(e=0;e<this.targets.length;e++)this.targets[e].destroyTextureBuffers(),this.targets[e].destroy();this.targets.length=0},BloomEffect.prototype._resize=function(e){var t,o=e.colorBuffer.width,r=e.colorBuffer.height;if(o!==this.width||r!==this.height)for(this.width=o,this.height=r,this._destroy(),t=0;t<2;t++){var s=new pc.Texture(this.device,{name:"Bloom Texture"+t,format:pc.PIXELFORMAT_RGBA8,width:o>>1,height:r>>1,mipmaps:!1});s.minFilter=pc.FILTER_LINEAR,s.magFilter=pc.FILTER_LINEAR,s.addressU=pc.ADDRESS_CLAMP_TO_EDGE,s.addressV=pc.ADDRESS_CLAMP_TO_EDGE,s.name="pe-bloom-"+t;var i=new pc.RenderTarget({name:"Bloom Render Target "+t,colorBuffer:s,depth:!1});this.targets.push(i)}},Object.assign(BloomEffect.prototype,{render:function(e,t,o){this._resize(e);var r=this.device.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(this.targets[0],this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),this.drawQuad(this.targets[1],this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),this.drawQuad(this.targets[0],this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),this.drawQuad(t,this.combineShader,o)}});var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){if(this.effect=new BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity,this.entity.camera){var e=this.entity.camera.postEffects;e.addEffect(this.effect)}this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect),this.effect._destroy()}))};var PlayerJump=pc.createScript("PlayerJump"),jumpTimer=0;PlayerJump.attributes.add("jump_power",{type:"number",default:0,title:"Jump Power",description:"Power of your Jump"}),PlayerJump.prototype.initialize=function(){this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this),this.entity.collision.on("collisionstart",this.onCollisionStart,this),this.entity.collision.on("collisionend",this.onCollisionEnd,this)},PlayerJump.prototype.onCollisionStart=function(o){console.log("result",o.name),"undefined"===o.name&&(onGround=!0)},PlayerJump.prototype.onCollisionEnd=function(o){console.log("other",o.name),"nav mesh.003"!==o.name&&"hero scene Collision mesh"!==o.name||(onGround=!1)},PlayerJump.prototype.update=function(o){this.app.keyboard.isPressed(pc.KEY_SPACE)&&!0===onGround&&this.entity.rigidbody.applyImpulse(0,this.jump_power,0),this.app.keyboard.isPressed(pc.KEY_SPACE)?jumpTimer<=0&&(this.entity.rigidbody.applyImpulse(0,500,0),jumpTimer=.1):jumpTimer>=0?jumpTimer-=o:jumpTimer=0};var AnimatingTextures=pc.createScript("animatingTextures");AnimatingTextures.attributes.add("materialAsset",{type:"asset"}),AnimatingTextures.attributes.add("speed",{type:"vec2"}),AnimatingTextures.tmpVec2=new pc.Vec2,AnimatingTextures.tmpOffset=new pc.Vec2,AnimatingTextures.prototype.initialize=function(){this.materialAsset&&(this.material=this.materialAsset.resource)},AnimatingTextures.prototype.update=function(t){var e=AnimatingTextures.tmpVec2,i=AnimatingTextures.tmpOffset;e.set(this.speed.x,this.speed.y),e.scale(t),i.copy(this.material.diffuseMapOffset),i.add(e),this.material.diffuseMapOffset=i,this.material.normalMapOffset=i,this.material.update()};var Motion=pc.createScript("motion");Motion.attributes.add("motions",{type:"json",schema:[{name:"name",type:"string"},{name:"position",type:"curve",curves:["x","y","z"]},{name:"rotation",type:"curve",curves:["x","y","z"]},{name:"scale",type:"curve",curves:["x","y","z"]},{name:"speed",type:"number",default:1},{name:"autoplay",type:"boolean",default:!1},{name:"loop",type:"boolean",default:!1}],array:!0}),Motion.attributes.add("events",{type:"json",schema:[{name:"animationName",type:"string"},{name:"eventName",type:"string"},{name:"time",type:"number",default:1},{name:"type",type:"string",default:"Anytime",enum:[{Anytime:"Anytime"},{Start:"Start"},{End:"End"}]}],array:!0}),Motion.attributes.add("lerp",{type:"number",default:.5}),Motion.prototype.initialize=function(){this.timestamp=0,this.currentSpeed=0,this.currentMotion=!1,this.isReverting=!1,this.startPosition=this.entity.getLocalPosition().clone(),this.startRotation=this.entity.getLocalEulerAngles().clone(),this.startScale=this.entity.getLocalScale().clone(),this.position=new pc.Vec3(0,0,0),this.rotation=new pc.Vec3(0,0,0),this.scale=new pc.Vec3(0,0,0),this.motions.length>0&&this.motions[0].autoplay&&this.onMotionPlay(this.motions[0].name),this.app.on("Motion",this.onMotionPlay,this),this.app.on("Motion:Stop",this.onMotionStop,this),this.entity.on("Motion",this.onMotionPlay,this),this.entity.on("Motion:Stop",this.onMotionStop,this)},Motion.prototype.findMotion=function(t){var i=!1;for(var n in this.motions){var e=this.motions[n];e.name==t&&(i=e)}return i},Motion.prototype.onMotionStop=function(t){this.currentMotion&&this.currentMotion.name==t&&(this.isPlaying=!1,this.currentMotion=!1)},Motion.prototype.onMotionPlay=function(t,i){if(!i&&this.currentMotion&&this.currentMotion.name==t)return!1;var n=this.findMotion(t);if(!n)return!1;this.isPlaying=!0,this.timestamp=0,this.currentMotion=n,this.triggerStartEvent(this.currentMotion)},Motion.prototype.triggerEvents=function(t){for(var i in this.events){var n=this.events[i],e=n.time;n.animationName==this.currentMotion.name&&e>this.timestamp&&e<=this.timestamp+t&&this.app.fire(n.eventName)}},Motion.prototype.findEventByMotion=function(t,i){for(var n in this.events){var e=this.events[n];if(e.animationName==t.name&&e.type==i)return e}},Motion.prototype.triggerStartEvent=function(t){var i=this.findEventByMotion(t,"Start");i&&this.app.fire(i.eventName)},Motion.prototype.triggerEndEvent=function(t){var i=this.findEventByMotion(t,"End");i&&this.app.fire(i.eventName)},Motion.prototype.update=function(t){if(!this.isPlaying)return!1;if(!this.currentMotion)return!1;var i=this.currentMotion.position.value(this.timestamp),n=this.currentMotion.rotation.value(this.timestamp),e=this.currentMotion.scale.value(this.timestamp);this.position=this.position.lerp(this.position,new pc.Vec3(i[0],i[1],i[2]),this.lerp),this.rotation=this.rotation.lerp(this.rotation,new pc.Vec3(n[0],n[1],n[2]),this.lerp),this.scale=this.scale.lerp(this.scale,new pc.Vec3(e[0],e[1],e[2]),this.lerp),this.entity.setLocalPosition(this.position.clone().add(this.startPosition)),this.entity.setLocalEulerAngles(this.rotation.clone().add(this.startRotation)),this.entity.setLocalScale(this.scale.clone().add(this.startScale)),this.triggerEvents(t),this.timestamp>=1&&(this.isPlaying=!1,this.currentMotion.loop?this.onMotionPlay(this.currentMotion.name,!0):(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1)),this.isReverting?(this.timestamp-=t*this.currentMotion.speed,this.timestamp<=0&&(this.triggerEndEvent(this.currentMotion),this.currentMotion=!1,this.isPlaying=!1,this.isReverting=!1)):this.timestamp+=t*this.currentMotion.speed,this.timestamp=Math.max(this.timestamp,0),this.timestamp=Math.min(this.timestamp,1)};var Videotexture=pc.createScript("video");Videotexture.attributes.add("materials",{type:"asset",assetType:"material",array:!0}),Videotexture.attributes.add("videoUrl",{type:"string"}),Videotexture.attributes.add("videoAsset",{title:"Video Asset",description:"MP4 video asset to play back on this video texture.",type:"asset"}),Videotexture.prototype.initialize=function(){var e=this.app,t=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R5_G6_B5,autoMipmap:!1});t.minFilter=pc.FILTER_LINEAR,t.magFilter=pc.FILTER_LINEAR,t.addressU=pc.ADDRESS_CLAMP_TO_EDGE,t.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var i=document.createElement("video");i.addEventListener("canplay",(function(e){t.setSource(i)})),this.videoAsset&&(i.src=this.videoAsset?this.videoAsset.getFileUrl():this.videoUrl),i.crossOrigin="anonymous";var s=i.style;s.position="absolute",s.opacity="1",s.zIndex="1000",i.loop=!0,i.preload=!0,i.muted=!0,i.play();for(var a=0;a<this.materials.length;a++){var o=this.materials[a].resource;o.emissiveMap=t,o.update()}this.videoTexture=t,this.upload=!0},Videotexture.prototype.update=function(e){this.upload=!this.upload,this.upload&&this.videoTexture.upload()};pc.script.createLoadingScreen((function(e){var t,a;t=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    width: 100%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 2px;","    width: 100%;","    background-color: #1d292c;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #f60;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(a=document.createElement("style")).type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(document.createTextNode(t)),document.head.appendChild(a),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var a=document.createElement("img");a.src="https://wtsverse.com/images/logo.png",t.appendChild(a),a.onload=function(){t.style.display="block"};var o=document.createElement("div");o.id="progress-bar-container",t.appendChild(o);var n=document.createElement("div");n.id="progress-bar",o.appendChild(n)}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));